(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order"],{"7e6a":function(e,n,t){"use strict";var r;t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return r}));var o=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.HMmessages=e.$refs.HMmessages})},a=[]},"91ba":function(e,n,t){"use strict";t.r(n);var r=t("7e6a"),o=t("b7ee");for(var a in o)"default"!==a&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t("f38a");var c,i=t("f0c5"),u=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],c);n["default"]=u.exports},"97e4":function(e,n,t){"use strict";(function(e){t("5b8f");r(t("66fd"));var n=r(t("91ba"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},b7ee:function(e,n,t){"use strict";t.r(n);var r=t("c5d2"),o=t.n(r);for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},c5d2:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=c(t("a34a")),o=t("dd11"),a=t("c845");function c(e){return e&&e.__esModule?e:{default:e}}function i(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(s){return void t(s)}i.done?n(u):Promise.resolve(u).then(r,o)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function c(e){i(a,r,o,c,u,"next",e)}function u(e){i(a,r,o,c,u,"throw",e)}c(void 0)}))}}var s=console,d=(s.log,function(){t.e("components/HM-messages/HM-messages").then(function(){return resolve(t("00d6"))}.bind(null,t)).catch(t.oe)}),f=wx.cloud.database(),l=f.collection("Shopping"),p=f.collection("Order"),h={components:{HMmessages:d},data:function(){return{homeload:!0,orderdata:[],obtainprice:"",name:"",phone:"",carded:"",Placeorder:""}},methods:{orDerdata:function(){var e=this;l.where({Selection:"show"}).get().then((function(n){e.orderdata=n.data,e.homeload=!1})).catch((function(e){console.log(e)}))},btnShopping:function(){var e=this;(0,o.erring)(this.name,this.phone,this.carded).then((function(n){if("SUCCESS"==n)e.weChatorder();else{var t="danger";e.tips(n,t)}})).catch((function(e){console.log(e)}))},weChatorder:function(){var e=this;return u(r.default.mark((function n(){var t,o,a,c,i,u,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return wx.showToast({title:"正在下单",icon:"loading",mask:!0}),t={name:e.name,phone:e.phone,carded:e.carded},o={peopleobj:t,arrinfo:e.orderdata},a=e.orderdata[0].shopid,c=a.slice(0,7),i=e.orderdata[0].title,n.next=8,e.placeOrder(c,i,o);case 8:return u=n.sent,n.next=11,e.orderInfo(u);case 11:return s=n.sent,n.next=14,e.wxPay(s,u);case 14:return n.sent,n.next=17,e.paySucc(s,u);case 17:n.sent;case 18:case"end":return n.stop()}}),n)})))()},placeOrder:function(e,n,t){var r=this;return new Promise((function(o,c){var i={type:"placeOrder",goodId:e,commodity:n,Price:r.obtainprice,Paymentinfor:t};(0,a.wxpay)(i).then((function(e){var n=e.result.orderdata._id;o(n)})).catch((function(e){c(e)}))}))},orderInfo:function(e){var n=this;return new Promise((function(t,r){var o={type:"queryorder",Placeorder:e};(0,a.wxpay)(o).then((function(e){var n=e.result.result.data[0];t(n),wx.hideToast()})).catch((function(e){var t="支付出现错误",r="danger";n.tips(t,r),wx.hideToast()}))}))},wxPay:function(e,n){var t=this;return new Promise((function(r,o){wx.requestPayment({timeStamp:e.time_stamp,nonceStr:e.nonceStr,package:"prepay_id=".concat(e.prepayId),signType:"MD5",paySign:e.payauto,success:function(e){r(e)},fail:function(e){console.log(e);var r="支付错误",o="success";t.tips(r,o),p.doc(n).remove().then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}})}))},paySucc:function(n,t){var r=this;return new Promise((function(o,c){var i={type:"paysucc",Placeorder:t,out_trade_no:n.out_trade_no};(0,a.wxpay)(i).then((function(n){if(o(n),"支付成功"==n.result.tips){var t="购买成功",a="success";r.tips(t,a),e.redirectTo({url:"../Myorder/myorder"})}})).catch((function(e){console.log(e)}))}))},tips:function(e,n){this.HMmessages.show(e,{icon:n,iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})}},onLoad:function(e){var n=JSON.parse(e.ids);"Shopping"==n.page?(this.obtainprice=n.obtainprice,this.orDerdata()):(this.obtainprice=n.orderdata[0].totalPrice,this.orderdata=n.orderdata,this.homeload=!1)}};n.default=h}).call(this,t("543d")["default"])},d044:function(e,n,t){},f38a:function(e,n,t){"use strict";var r=t("d044"),o=t.n(r);o.a}},[["97e4","common/runtime","common/vendor"]]]);