(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/MyCart/mycart"],{"4eeb":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=a(e("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,n,e,i,a,o,r){try{var c=t[o](r),s=c.value}catch(l){return void e(l)}c.done?n(s):Promise.resolve(s).then(i,a)}function r(t){return function(){var n=this,e=arguments;return new Promise((function(i,a){var r=t.apply(n,e);function c(t){o(r,i,a,c,s,"next",t)}function s(t){o(r,i,a,c,s,"throw",t)}c(void 0)}))}}var c=wx.cloud.database(),s=c.collection("Shopping"),l=function(){e.e("components/HM-messages/HM-messages").then(function(){return resolve(e("00d6"))}.bind(null,e)).catch(e.oe)},u=function(){e.e("element/order").then(function(){return resolve(e("9e89"))}.bind(null,e)).catch(e.oe)},f={components:{HMmessages:l,order:u},data:function(){return{mycary:!1,homeload:!0,samllload:!1,alldats:"hide",labfale:!1,editdata:"编辑",shopbottom:!0,current:"",indexArray:[],shoplist:[],select:"",obtainprice:0,arrtotalPrice:[],fandsdata:{},Duplicate:[]}},methods:{finalchange:function(){var t=this;s.get().then((function(n){if(0===n.data.length){t.homeload=!1,t.mycary=!1;var e=!0,i="购物车空空如也！";t.nohint(e,i)}else{var a=n.data;t.setUp(a)}})).catch((function(t){console.log(t)}))},setUp:function(t){var n=this;return r(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.forchange(t);case 2:return e.sent,e.next=5,n.shopdatas();case 5:case"end":return e.stop()}}),e)})))()},forchange:function(t){return new Promise((function(n,e){var i=0;t.forEach((function(a){s.doc(a._id).update({data:{Selection:"hide"}}).then((function(e){i++,i===t.length&&n("success")})).catch((function(t){e(t)}))}))}))},shopdatas:function(){var t=this;s.get().then((function(n){if(0!=n.data.length){t.shoplist=n.data,t.mycary=!0;var e=!1,i="";return t.nohint(e,i),void(t.homeload=!1)}t.mycary=!1;var a=!0,o="购物车空空如也！";t.nohint(a,o),t.homeload=!1})).catch((function(t){console.log(t)}))},eDit:function(){this.editdata="完成"==this.editdata?"编辑":"完成","完成"==this.editdata?this.shopbottom=!1:"编辑"==this.editdata&&(this.shopbottom=!0)},radioLin:function(t,n,e){if(this.samllload=!0,"hide"==t){var i="show";this.selecTion(i,n),this.indexArray.push(n);var a={id:n,totalPrice:e};this.arrtotalPrice.push(a)}else{var o="hide";this.selecTion(o,n);var r=this.indexArray.indexOf(n);this.indexArray.splice(r,1);var c=[n],s=this.arrtotalPrice.filter((function(t){return!c.includes(t.id)}));this.arrtotalPrice=s}},selecTion:function(t,n){var e=this;s.doc(n).update({data:{Selection:t}}).then((function(t){e.shopdatas(),e.samllload=!1})).catch((function(t){console.log(t)}))},deleShop:function(){var t=this;this.samllload=!0,this.indexArray.forEach((function(n){s.doc(n).remove().then((function(e){t.indexArray=[],t.shopdatas();var i=t.arrtotalPrice.filter((function(t){return!n.includes(t.id)}));t.arrtotalPrice=i,t.samllload=!1})).catch((function(t){console.log(t)}))}))},Allelection:function(){var t=this;if(this.samllload=!0,"hide"==this.alldats){var n="show";this.publicAll(n),this.shoplist.forEach((function(n){var e={id:n._id,totalPrice:n.totalPrice};t.arrtotalPrice.push(e),t.Duplicate.push(n._id),t.indexArray=Array.from(new Set(t.Duplicate))}))}else{var e="hide";this.publicAll(e),this.obtainprice=0,this.arrtotalPrice=[],this.indexArray=[]}},publicAll:function(t){var n=this,e=0;this.shoplist.forEach((function(i){s.doc(i._id).update({data:{Selection:t}}).then((function(t){e++,e===n.shoplist.length&&(n.shopdatas(),n.samllload=!1)})).catch((function(t){console.log(t)}))}))},pLus:function(t,n,e){this.samllload=!0,n++;var i=t*n;this.publicPrice(e,n,i)},reDuce:function(t,n,e){if(1===n){var i="购买数量最少为1",a="danger";this.tips(i,a)}else{this.samllload=!0,n--;var o=t*n;this.publicPrice(e,n,o)}},publicPrice:function(t,n,e){var i=this;s.doc(t).update({data:{many:n,totalPrice:e}}).then((function(n){s.where({_id:t}).get().then((function(n){var e=n.data[0].totalPrice,a={id:t,totalPrice:e},o=i.arrtotalPrice.map((function(n){return n.id==t?a:n}));i.arrtotalPrice=o,i.samllload=!1})).catch((function(t){console.log(t)})),i.shopdatas()})).catch((function(t){console.log(t)}))},placEorder:function(){var n={obtainprice:this.obtainprice,page:"Shopping"},e=JSON.stringify(n);t.navigateTo({url:"../order/order?ids="+e})},tips:function(t,n){this.HMmessages.show(t,{icon:n,iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})},nohint:function(t,n){var e=this;this.$nextTick((function(){e.$refs.orderlisty.init(t,n)}))}},mounted:function(){this.finalchange()},computed:{deleBtn:function(){0==this.indexArray.length?this.labfale=!1:this.labfale=!0},allList:function(){var t=this.shoplist.map((function(t){return t.Selection}));this.select=t},Calculation:function(){var t={},n=this.arrtotalPrice.reduce((function(n,e){return!t[e.id]&&(t[e.id]=n.push(e)),n}),[]),e=0;n.forEach((function(t){e+=t.totalPrice})),this.obtainprice=parseFloat(e.toFixed(10))}},watch:{select:function(t,n){var e=t.every((function(t){return"show"===t}));this.alldats=!0===e?"show":"hide"}}};n.default=f}).call(this,e("543d")["default"])},7842:function(t,n,e){},"7f2e":function(t,n,e){"use strict";var i=e("7842"),a=e.n(i);a.a},bc1c:function(t,n,e){"use strict";e.r(n);var i=e("4eeb"),a=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(n,t,(function(){return i[t]}))}(o);n["default"]=a.a},c2ff:function(t,n,e){"use strict";e.r(n);var i=e("c9d5"),a=e("bc1c");for(var o in a)"default"!==o&&function(t){e.d(n,t,(function(){return a[t]}))}(o);e("7f2e");var r,c=e("f0c5"),s=Object(c["a"])(a["default"],i["b"],i["c"],!1,null,"d5126d0c",null,!1,i["a"],r);n["default"]=s.exports},c9d5:function(t,n,e){"use strict";var i;e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return i}));var a=function(){var t=this,n=t.$createElement;t._self._c;t._isMounted||(t.e0=function(n){t.labfale&&t.placEorder()},t.e1=function(n){t.labfale&&t.deleShop()},t.e2=function(n){t.HMmessages=t.$refs.HMmessages})},o=[]},dbb5:function(t,n,e){"use strict";(function(t){e("5b8f");i(e("66fd"));var n=i(e("c2ff"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(n.default)}).call(this,e("543d")["createPage"])}},[["dbb5","common/runtime","common/vendor"]]]);