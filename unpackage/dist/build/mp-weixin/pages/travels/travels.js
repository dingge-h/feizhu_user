(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/travels/travels"],{"2bc2":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(n("a34a")),o=n("d97e"),i=n("26cb");function r(t){return t&&t.__esModule?t:{default:t}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e,n,a,o,i,r){try{var c=t[i](r),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(a,o)}function f(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function r(t){d(i,a,o,r,c,"next",t)}function c(t){d(i,a,o,r,c,"throw",t)}r(void 0)}))}}function l(t){return v(t)||p(t)||m(t)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(t,e){if(t){if("string"===typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function p(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function v(t){if(Array.isArray(t))return b(t)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var g=console,y=g.log,w=n("9983"),O=w.formatTime(new Date),P=function(){n.e("components/HM-messages/HM-messages").then(function(){return resolve(n("00d6"))}.bind(null,n)).catch(n.oe)},M=function(){Promise.all([n.e("common/vendor"),n.e("element/modal")]).then(function(){return resolve(n("f06d"))}.bind(null,n)).catch(n.oe)},_=wx.cloud.database(),j=_.collection("user"),I={components:{HMmessages:P,motal:M},data:function(){return{num:0,fication:[{name:"景点"},{name:"美食"},{name:"网红打卡"}],topimg:[],uploadvideos:!1,videos:"",address:"武汉市",classdata:"景点",titledata:"",tipsdata:"",modaishow:!1,avatarUrl:"",nickName:"",openid:"",reldata:"正在发布...请勿关闭该页面",relend:!1,watchaddress:""}},methods:{menubtn:function(t,e){this.num=t,this.classdata=e},uploadImg:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(t){var n;(n=e.topimg).push.apply(n,l(t.tempFilePaths))},fail:function(t){console.log(t)}})},preImage:function(t){var e=this.topimg;(0,o.preview)(t,e).then((function(t){})).catch((function(t){console.log(t)}))},deleteImg:function(t){this.topimg.splice(t,1)},uploadVideo:function(){var e=this;t.showLoading({title:"上传中"}),t.chooseVideo({count:1,sourceType:["camera","album"],maxDuration:20}).then((function(n){e.videos=n[1].tempFilePath,e.uploadvideos=!0,t.hideLoading()})).catch((function(e){t.hideLoading()}))},deleteVideo:function(){this.videos="",this.uploadvideos=!1},addRess:function(){var t=this;(0,o.addressdata)().then((function(e){var n=e.result.ad_info.city;t.address=n})).catch((function(e){t.address="武汉市"}))},chooseCity:function(){t.navigateTo({url:"../city/city"})},suBmitd:function(){if(""==this.titledata){var t="请填写标题";this.proMpt(t)}else if(""==this.tipsdata){var e="请填写描述";this.proMpt(e)}else if(this.topimg.length<3){var n="上传的图片不少于三张";this.proMpt(n)}else this.userinfo()},userinfo:function(){var t=this;j.get().then((function(e){if(0==e.data.length){var n="登陆后再发布";t.$nextTick((function(){t.$refs.mon.init(n)}))}else{var a=e.data[0];t.avatarUrl=a.avatarUrl,t.nickName=a.nickName,t.openid=a._openid,t.relend=!0,t.userdata()}})).catch((function(t){y(t)}))},userdata:function(){var t=this;return f(a.default.mark((function e(){var n,o;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.staticImg();case 2:return n=e.sent,e.next=5,t.staticVideo();case 5:return o=e.sent,e.next=8,t.cloudData(n,o);case 8:case"end":return e.stop()}}),e)})))()},staticImg:function(){var t=this,e=[];return new Promise((function(n,a){t.topimg.forEach((function(a){var o=a.lastIndexOf("."),i=a.slice(o),r="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(i);wx.cloud.uploadFile({cloudPath:"static/"+r,filePath:a}).then((function(a){e.push(a.fileID),e.length==t.topimg.length&&n(e)})).catch((function(t){console.log(t)}))}))}))},staticVideo:function(){var t=this;return new Promise((function(e,n){if(""==t.videos)e("");else{var a=t.videos.lastIndexOf("."),o=t.videos.slice(a),i="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(o);wx.cloud.uploadFile({cloudPath:"staticvideo/"+i,filePath:t.videos}).then((function(t){e(t.fileID)})).catch((function(t){console.log(t)}))}}))},cloudData:function(e,n){var a=this,o={time:O,classdata:this.classdata,titledata:this.titledata,tipsdata:this.tipsdata,address:this.address,avatarUrl:this.avatarUrl,nickName:this.nickName,openid:this.openid,staticimg:e,staticvideo:n};_.collection("userdata").add({data:{datainfo:o}}).then((function(e){a.reldata="发布成功，正在跳转...";var n=!0;setTimeout((function(){t.switchTab({url:"../strategy/strategy"}),a.$store.commit("roturnmuta",n)}),1700)})).catch((function(t){y(t)}))},proMpt:function(t){this.HMmessages.show(t,{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(102, 0, 51,.8)"})}},created:function(){this.addRess()},computed:s(s({},(0,i.mapState)(["travecity"])),{},{count:function(){this.watchaddress=this.travecity.traveing}}),watch:{watchaddress:function(t,e){this.address=t}}};e.default=I}).call(this,n("543d")["default"])},"36c2":function(t,e,n){"use strict";n.r(e);var a=n("2bc2"),o=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=o.a},"66b3":function(t,e,n){"use strict";n.r(e);var a=n("b4cc"),o=n("36c2");for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n("74e2");var r,c=n("f0c5"),s=Object(c["a"])(o["default"],a["b"],a["c"],!1,null,"71b0ece8",null,!1,a["a"],r);e["default"]=s.exports},"6bd5":function(t,e,n){"use strict";(function(t){n("5b8f");a(n("66fd"));var e=a(n("66b3"));function a(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"74e2":function(t,e,n){"use strict";var a=n("d774"),o=n.n(a);o.a},b4cc:function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return a}));var o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.HMmessages=t.$refs.HMmessages})},i=[]},d774:function(t,e,n){}},[["6bd5","common/runtime","common/vendor"]]]);